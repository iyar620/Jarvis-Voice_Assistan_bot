<!doctype html>
<html lang="he">
<head>
  <link rel="shortcut icon"
 href="favicon.ico" />
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Jarvis — בוט קולי מודרני</title>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
  <style>
    :root{--bg:#05060a;--panel:#0e1720;--accent1:#28d5c5;--accent2:#7c5cff;--muted:rgba(255,255,255,0.7)}
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial}
    body{background:radial-gradient(800px 400px at 15% 12%, rgba(124,92,255,0.06), transparent),var(--bg);color:#e6eef8}
    .app{max-width:1100px;margin:28px auto;padding:20px;display:grid;grid-template-columns:420px 1fr;gap:16px}
    .panel{background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent);padding:16px;border-radius:12px}
    .brand{display:flex;gap:12px;align-items:center}
    .logo{width:56px;height:56px;border-radius:12px;background:linear-gradient(135deg,var(--accent2),var(--accent1));display:flex;align-items:center;justify-content:center}

    .eyeBox{height:120px;background:rgba(255,255,255,0.01);border-radius:10px;margin-top:14px;display:flex;align-items:center;justify-content:center}
    .controls{display:flex;gap:8px;align-items:center;margin-top:12px}
    .micBtn{background:linear-gradient(90deg,var(--accent2),var(--accent1));border:none;padding:12px 14px;border-radius:10px;color:#021019;font-weight:700;cursor:pointer}
    .micBtn.listening{box-shadow:0 8px 30px rgba(124,92,255,0.12),0 0 0 6px rgba(124,92,255,0.03)}
    .voiceSelect{margin-left:auto;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:var(--muted)}

    .chatArea{background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent);padding:16px;border-radius:12px;display:flex;flex-direction:column}
    .messages{flex:1;overflow:auto;display:flex;flex-direction:column;gap:12px;padding:8px}
    .msg{max-width:70%;padding:12px;border-radius:12px;background:rgba(255,255,255,0.02)}
    .msg.user{align-self:flex-end;background:linear-gradient(180deg, rgba(124,92,255,0.12), rgba(79,209,197,0.06));color:#021019}
    .meta{font-size:11px;color:var(--muted);margin-bottom:6px}

    .footer{display:flex;gap:8px;align-items:center;padding-top:12px}
    .input input{width:100%;padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit}
    .sendBtn{padding:10px 14px;border-radius:10px;border:none;background:linear-gradient(90deg,var(--accent2),var(--accent1));color:#021019;font-weight:700;cursor:pointer}
    canvas#wave{width:100%;height:64px;border-radius:8px;margin-top:12px}
    @media(max-width:980px){.app{grid-template-columns:1fr}} 
  </style>
</head>
<body dir="rtl">
  <div class="app">
    <div class="panel">
      <div class="brand">
        <div class="logo">
  <img src="logo.png" alt="Logo" style="width:80%;height:80%;object-fit:contain;border-radius:8px;display:block;margin:auto;">
</div>
        <div><h2 style="margin:0;font-family:Orbitron">Jarvis</h2><div style="font-size:13px;color:var(--muted)">בוט קולי—יציב, מהיר ונוח</div></div>
      </div>

      <div class="eyeBox">
        <svg id="eyeSVG" viewBox="0 0 200 60" width="100%" height="100%">
          <ellipse cx="100" cy="30" rx="70" ry="22" fill="#07101a"/>
          <g id="pupilGroup"><circle id="pupil" cx="100" cy="30" r="12" fill="#e6eef8"/><circle id="glow" cx="100" cy="30" r="26" fill="#7c5cff" opacity="0.09"/></g>
        </svg>
      </div>

      <div class="controls">
        <button id="micBtn" class="micBtn">הפעל מיקרופון</button>
        <select id="voiceSelect" class="voiceSelect"></select>
      </div>

      <canvas id="wave"></canvas>

      <div style="margin-top:10px;color:var(--muted);font-size:13px">הערה: הדפדפן חייב לאפשר שימוש במיקרופון (https או localhost). השתמש ב־Chrome/Edge לקבלת חוויית זיהוי הטובה ביותר.</div>
    </div>

    <div class="chatArea">
      <div id="messages" class="messages" aria-live="polite"></div>
      <div class="footer">
        <div class="input"><input id="textInput" placeholder="הקלד שאלה או לחץ על מיקרופון" autocomplete="off"></div>
        <button id="sendBtn" class="sendBtn">שלח</button>
      </div>
    </div>
  </div>

  <script>
    /*
      גרסה זו עושה מאמץ להגביר אמינות בזיהוי דיבור ותגובות:
      - תמיכה ב־getUserMedia + WebAudio לויזואליזציה
      - שימוש ב־SpeechRecognition (Web Speech API) עם interim results
      - ניתוב לקריאות שרת ל־/api/ai (אם קיים) עם timeout
      - fallback חזק בצד לקוח: פקודות מובנות, חישובים בטוחים, פתיחת Spotify/חיפוש
      - הוראות שרת מופיעות בתחתית הקובץ (כמפרט)
    */

    const $ = id => document.getElementById(id);
    const messages = $('messages');

    function addMessage(text, who='jarvis', opts={}){
      const el = document.createElement('div'); el.className = 'msg ' + (who==='user' ? 'user' : 'bot');
      el.innerHTML = `<div class="meta">${who==='user' ? 'אתה' : 'Jarvis'}</div><div class="body">${escapeHtml(text)}</div>`;
      messages.appendChild(el); messages.scrollTop = messages.scrollHeight; return el;
    }
    function escapeHtml(s){ return String(s).replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'})[c]); }

    // Waveform setup
    const wave = $('wave'); const wctx = wave.getContext('2d'); function resizeCanvas(){ wave.width = wave.clientWidth * devicePixelRatio; wave.height = wave.clientHeight * devicePixelRatio; wctx.setTransform(devicePixelRatio,0,0,devicePixelRatio,0,0);} window.addEventListener('resize',resizeCanvas); resizeCanvas();
    function drawWave(level){ wctx.clearRect(0,0,wave.width,wave.height); const h = wave.clientHeight; const w = wave.clientWidth; const amp = Math.max(2, level*36); wctx.beginPath(); for(let x=0;x<w;x+=3){ const y = h/2 + Math.sin(x/12 + performance.now()/300)*amp*(1 - Math.abs((x-w/2)/(w/2))); wctx.lineTo(x,y);} wctx.strokeStyle='rgba(124,92,255,0.95)'; wctx.lineWidth=2; wctx.stroke(); }

    // Speech synthesis (TTS)
    const synth = window.speechSynthesis; const voiceSelect = $('voiceSelect'); function populateVoices(){ const vs = synth.getVoices(); voiceSelect.innerHTML=''; vs.forEach(v=>{ const o=document.createElement('option'); o.value=v.name; o.textContent=`${v.name} — ${v.lang}`; voiceSelect.appendChild(o); }); } populateVoices(); if(speechSynthesis.onvoiceschanged!==undefined) speechSynthesis.onvoiceschanged = populateVoices;
    function speak(text, langHint){ if(!text) return; const u=new SpeechSynthesisUtterance(String(text)); const v = synth.getVoices().find(x=>x.name===voiceSelect.value); if(v) u.voice=v; if(langHint) u.lang = langHint; synth.cancel(); synth.speak(u); }

    // Speech recognition & mic meter
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    let recognition = null; let audioStream=null; let audioContext=null; let analyser=null; let raf=null;

    function detectLangFromText(s){ return /[\u0590-\u05FF]/.test(s) ? 'he-IL' : 'en-US'; }

    async function startMic(){
      // request mic for visualizer first (robustness)
      try{
        audioStream = await navigator.mediaDevices.getUserMedia({audio:true});
      }catch(err){
        console.error('getUserMedia failed',err); alert('אין אפשרות לגשת למיקרופון. בדוק הרשאות/דפדפן.'); return;
      }

      audioContext = new (window.AudioContext || window.webkitAudioContext)();
      const source = audioContext.createMediaStreamSource(audioStream);
      analyser = audioContext.createAnalyser(); analyser.fftSize = 256; source.connect(analyser);
      monitorAudio();

      if(!SpeechRecognition){ alert('הדפדפן אינו תומך ב־SpeechRecognition. השתמש ב־Chrome/Edge.'); return; }

      recognition = new SpeechRecognition(); recognition.interimResults = true; recognition.maxAlternatives = 1; recognition.lang = 'he-IL';

      recognition.onstart = ()=>{ $('micBtn').classList.add('listening'); $('micBtn').textContent='מקשיב... לחץ כדי להפסיק'; };

      let interimEl = null;
      recognition.onresult = async (ev)=>{
        let interim = '';
        let final = '';
        for(let i=ev.resultIndex;i<ev.results.length;i++){ const r = ev.results[i]; if(r.isFinal) final += r[0].transcript; else interim += r[0].transcript; }
        // show interim while speaking
        if(interim){ if(!interimEl) interimEl = addMessage(interim,'user'); else interimEl.querySelector('.body').innerHTML = escapeHtml(interim + ' <span style="opacity:.6">(ממתין...)</span>'); }
        if(final){ if(interimEl){ interimEl.remove(); interimEl=null; } addMessage(final,'user'); const reply = await askAI(final); addMessage(reply,'jarvis'); speak(reply, detectLangFromText(reply)); }
      };

      recognition.onerror = (e)=>{ console.error('recognition error', e); if(e.error==='not-allowed' || e.error==='service-not-allowed') alert('ההרשאה למיקרופון נחסמה בדפדפן. בדוק את הגדרות הפרטיות.'); };
      recognition.onend = ()=>{ // auto stop visualizer but keep audio stream only if user toggled
        $('micBtn').classList.remove('listening'); $('micBtn').textContent='הפעל מיקרופון'; stopAudio(); // stop audio context to free resources
      };

      recognition.start();
    }

    function stopAudio(){ if(raf) cancelAnimationFrame(raf); raf=null; if(analyser) analyser.disconnect(); analyser=null; if(audioContext) try{ audioContext.close(); }catch(e){} audioContext=null; if(audioStream){ audioStream.getTracks().forEach(t=>t.stop()); audioStream=null; } drawWave(0); }

    function monitorAudio(){ if(!analyser){ drawWave(0); return; } const data = new Uint8Array(analyser.frequencyBinCount); analyser.getByteFrequencyData(data); const avg = data.reduce((a,b)=>a+b,0)/data.length/255; drawWave(avg); raf = requestAnimationFrame(monitorAudio); }

    // Improved AI routing and robust fallback
async function askAI(text){
  // תשובות מובנות
  const builtInAnswers = [
    // ברכות ושאלות כלליות
    { q: /שלום|היי|היי ג'ארוויס|היי ג׳ארוויס|היי ג׳רוויס|היי ג'רוויס|היי ג׳ארביס|היי ג'ארביס|היי ג׳ארביס|היי ג'ארביס|היי ג׳ארוויס|היי ג'ארוויס|היי ג׳רוויס|היי ג'רוויס|היי ג׳ארביס|היי ג'ארביס|היי ג׳ארביס|היי ג'ארביס|היי ג׳ארוויס|היי ג'ארוויס|היי ג׳רוויס|היי ג'רוויס|היי ג׳ארביס|היי ג'ארביס|היי ג׳ארביס|היי ג'ארביס/, a: "שלום! איך אפשר לעזור?" },
    { q: /מה שלומך|איך אתה מרגיש|איך אתה|מה נשמע|מה העניינים/, a: "אני מרגיש מצוין! איך אפשר לעזור?" },
    { q: /מה שמך|איך קוראים לך|מי אתה|מי את|מה השם שלך/, a: "אני ג'ארוויס, הבוט הקולי שלך." },
    { q: /מי יצר אותך|מי בנה אותך|מי פיתח אותך|מי תכנת אותך/, a: "נוצרתי על ידי מפתחי קוד פתוח." },
    { q: /מה אתה יודע לעשות|מה אתה עושה|מה אתה יכול|מה אתה מסוגל|מה אתה יודע/, a: "אני יודע להקשיב, לענות, לבצע חיפושים, לנגן מוזיקה, לחשב, לספר בדיחות ועוד." },
    { q: /מה אתה|מה את|מי אתה|מי את/, a: "אני עוזר קולי חכם — ג'ארוויס." },
    { q: /מה חדש|מה התחדש|ספר לי משהו חדש/, a: "הכל רגיל אצלי. רוצה לשאול משהו מסוים?" },

    // זמן ותאריך
    { q: /מה השעה|כמה השעה|תגיד לי את השעה|איזו שעה/, a: () => new Date().toLocaleTimeString() },
    { q: /איזה יום היום|מה היום|מה התאריך|איזה תאריך/, a: () => new Date().toLocaleDateString() },

    // בדיחות
    { q: /ספר בדיחה|תן בדיחה|תצחיק אותי|יש לך בדיחה/, a: "למה התכנת לא הלך לים? כי הוא פחד מהבאגים!" },
    { q: /בדיחה על תכנות|בדיחה על מתכנתים/, a: "איך קוראים למתכנת שמאחר לעבודה? דיליי-פרוגרמר!" },
    { q: /בדיחה על רובוטים|בדיחה על בינה מלאכותית/, a: "למה הרובוט לא הלך למסיבה? כי הוא לא רצה להיתקע בשקע!" },

    // מזג אוויר
    { q: /מה מזג האוויר|איך מזג האוויר|מה התחזית|מה הטמפרטורה/, a: "אני לא מחובר לשירות מזג אוויר כרגע, אבל תמיד אפשר לבדוק בגוגל!" },

    // מוזיקה
    { q: /נגן מוזיקה|נגן שיר|נגן משהו|תנגן לי שיר/, a: "איזה שיר תרצה לשמוע?" },
    { q: /תנגן לי משהו שמח|נגן שיר שמח/, a: "ממליץ על 'Happy' של Pharrell Williams!" },
    { q: /נגן שיר עצוב|תנגן לי משהו עצוב/, a: "ממליץ על 'Someone Like You' של Adele." },

    // חיפוש
    { q: /חפש בגוגל|מצא בגוגל|חפש מידע|מצא מידע/, a: "מה תרצה שאחפש עבורך?" },

    // מחשבון
    { q: /חשב לי|חשב|חשב חישוב|חשב תרגיל/, a: "אנא כתוב את התרגיל שתרצה לחשב." },

    // טריוויה
    { q: /כמה מדינות יש בעולם/, a: "נכון להיום יש 195 מדינות מוכרות בעולם." },
    { q: /מה העיר הגדולה בישראל/, a: "העיר הגדולה בישראל היא ירושלים." },
    { q: /מה ההר הגבוה בעולם/, a: "ההר הגבוה בעולם הוא האוורסט." },
    { q: /מה הנהר הארוך בעולם/, a: "הנהר הארוך בעולם הוא הנילוס." },
    { q: /מה החיה המהירה בעולם/, a: "החיה המהירה בעולם היא הברדלס." },

    // טכנולוגיה
    { q: /מה זה בינה מלאכותית|מה זה AI|מה זה אינטליגנציה מלאכותית/, a: "בינה מלאכותית היא טכנולוגיה שמאפשרת למחשבים לבצע משימות הדורשות חשיבה אנושית." },
    { q: /מה זה גיט|מה זה גיטהאב|מה זה GitHub/, a: "GitHub הוא שירות לניהול גרסאות קוד ושיתוף פרויקטים." },
    { q: /מה זה ענן|מה זה מחשוב ענן/, a: "מחשוב ענן הוא שירות שמאפשר גישה למשאבים דרך האינטרנט." },

    // בריאות
    { q: /איך לשמור על הבריאות|טיפים לבריאות|איך להיות בריא/, a: "לאכול נכון, להתאמן, לישון מספיק ולשמור על מצב רוח טוב!" },
    { q: /כמה מים לשתות ביום/, a: "מומלץ לשתות לפחות 8 כוסות מים ביום." },

    // ספורט
    { q: /מי זכה במונדיאל האחרון/, a: "ארגנטינה זכתה במונדיאל 2022." },
    { q: /מה השיא העולמי בריצה/, a: "השיא העולמי ל־100 מטר הוא 9.58 שניות, של יוסיין בולט." },

    // אוכל
    { q: /מה המאכל הכי פופולרי בעולם/, a: "המאכל הכי פופולרי בעולם הוא פיצה." },
    { q: /איך מכינים פסטה/, a: "מרתיחים מים, מוסיפים פסטה, מבשלים 8-10 דקות ומסננים." },

    // מדע
    { q: /מה המרחק בין כדור הארץ לשמש/, a: "המרחק הממוצע הוא כ־150 מיליון קילומטרים." },
    { q: /מה הגיל של היקום/, a: "היקום בן כ־13.8 מיליארד שנים." },

    // היסטוריה
    { q: /מי היה איינשטיין|מי זה איינשטיין/, a: "אלברט איינשטיין היה פיזיקאי יהודי גרמני, מפתח תורת היחסות." },
    { q: /מי היה הרצל|מי זה הרצל/, a: "בנימין זאב הרצל היה חוזה המדינה ומנהיג התנועה הציונית." },

    // שאלות על Jarvis
    { q: /אתה אמיתי|אתה רובוט|אתה בן אדם/, a: "אני בוט קולי, לא בן אדם אמיתי." },
    { q: /אתה מבין עברית|אתה מדבר עברית/, a: "כן, אני מבין ומדבר עברית!" },
    { q: /אתה מדבר אנגלית/, a: "כן, אני מבין גם אנגלית." },

    // שאלות על מחשבים
    { q: /מה זה מחשב|מה זה מעבד|מה זה זיכרון RAM/, a: "מחשב הוא מכשיר אלקטרוני לעיבוד נתונים. מעבד הוא הלב של המחשב, ו־RAM הוא זיכרון עבודה זמני." },

    // שאלות על אינטרנט
    { q: /מה זה אינטרנט|איך עובד האינטרנט/, a: "האינטרנט הוא רשת עולמית שמחברת מחשבים ומאפשרת שיתוף מידע." },

    // שאלות על ישראל
    { q: /מה עיר הבירה של ישראל/, a: "עיר הבירה של ישראל היא ירושלים." },
    { q: /מה השפה הרשמית בישראל/, a: "השפה הרשמית בישראל היא עברית." },

    // שאלות על חגים
    { q: /מתי פסח|מתי ראש השנה|מתי יום כיפור/, a: "תאריכי החגים משתנים לפי הלוח העברי. רוצה שאבדוק עבורך?" },

    // שאלות על עצמי
    { q: /מה הגרסה שלך|איזו גרסה אתה|איזה דגם אתה/, a: "אני ג'ארוויס גרסה יציבה 2025." },

    // שאלות על זמן
    { q: /כמה זמן נשאר עד סוף השנה/, a: () => {
      const now = new Date();
      const end = new Date(now.getFullYear(), 11, 31, 23, 59, 59);
      const diff = Math.floor((end - now) / (1000 * 60 * 60 * 24));
      return `נשארו עוד ${diff} ימים עד סוף השנה.`;
    }},

    // שאלות על שפות
    { q: /כמה שפות אתה יודע|באיזה שפות אתה מדבר/, a: "אני מבין עברית, אנגלית ועוד שפות רבות." },

    // שאלות על חיות
    { q: /מה החיה הכי גדולה בעולם/, a: "הלוויתן הכחול הוא החיה הגדולה בעולם." },
    { q: /מה החיה הכי מסוכנת/, a: "היתוש הוא החיה המסוכנת ביותר לאדם." },

    // שאלות על חלל
    { q: /מה כוכב הלכת הגדול ביותר/, a: "כוכב הלכת הגדול ביותר הוא צדק." },
    { q: /כמה כוכבי לכת יש במערכת השמש/, a: "יש שמונה כוכבי לכת במערכת השמש." },

    // שאלות על גוף האדם
    { q: /כמה עצמות יש בגוף האדם/, a: "בגוף האדם יש 206 עצמות." },
    { q: /מה האיבר הגדול ביותר בגוף/, a: "העור הוא האיבר הגדול ביותר בגוף האדם." },

    // שאלות על כסף
    { q: /מה המטבע של ישראל/, a: "המטבע של ישראל הוא שקל חדש." },
    { q: /מה המטבע של ארה"ב/, a: "המטבע של ארה\"ב הוא דולר." },

    // שאלות על אוכלוסייה
    { q: /כמה אנשים יש בישראל/, a: "בישראל חיים כ־9 מיליון אנשים." },
    { q: /כמה אנשים יש בעולם/, a: "בעולם חיים מעל 8 מיליארד אנשים." },

    // שאלות על ספורטאים
    { q: /מי השחקן הטוב בעולם בכדורגל/, a: "ליאו מסי נחשב לאחד השחקנים הטובים בעולם." },
    { q: /מי השחקן הטוב בעולם בכדורסל/, a: "לברון ג'יימס נחשב לאחד השחקנים הטובים בעולם." },

    // שאלות על סרטים
    { q: /מה הסרט הכי פופולרי|מה הסרט הכי מצליח/, a: "הסרט 'אווטאר' הוא מהמצליחים בעולם." },

    // שאלות על מוזיקה
    { q: /מי הזמר הכי פופולרי בעולם/, a: "אחד הזמרים הפופולריים הוא אד שירן." },

    // שאלות על ספרים
    { q: /מה הספר הכי נמכר בעולם/, a: "הספר הכי נמכר בעולם הוא התנ\"ך." },

    // שאלות על טבע
    { q: /מה העץ הכי גבוה בעולם/, a: "העץ הגבוה בעולם הוא הסקוויה." },

    // שאלות על תחבורה
    { q: /מה הרכב הכי מהיר בעולם/, a: "הרכב הכי מהיר הוא Bugatti Chiron Super Sport." },

    // שאלות על אוכל
    { q: /איך מכינים חביתה/, a: "טורפים ביצים, מוסיפים מלח ופלפל, מטגנים במחבת." },

    // שאלות על מדינות
    { q: /מה המדינה הגדולה בעולם/, a: "רוסיה היא המדינה הגדולה בעולם." },
    { q: /מה המדינה הקטנה בעולם/, a: "המדינה הקטנה בעולם היא הוותיקן." },

    // שאלות על דת
    { q: /מה הדת הגדולה בעולם/, a: "הדת הגדולה בעולם היא הנצרות." },

    // שאלות על אנרגיה
    { q: /מה מקור האנרגיה העיקרי בעולם/, a: "מקור האנרגיה העיקרי הוא נפט וגז טבעי." },

    // שאלות על מחשבים
    { q: /מה זה מערכת הפעלה|מה זה windows|מה זה לינוקס/, a: "מערכת הפעלה היא תוכנה שמנהלת את משאבי המחשב." },

    // שאלות על אינטרנט
    { q: /מה זה דפדפן|מה זה כרום|מה זה פיירפוקס/, a: "דפדפן הוא תוכנה לגלישה באינטרנט." },

    // שאלות על טלפון
    { q: /מה הטלפון הכי מתקדם/, a: "אחד הטלפונים המתקדמים הוא iPhone 15 Pro." },

    // שאלות על אפליקציות
    { q: /מה האפליקציה הכי פופולרית/, a: "אחת האפליקציות הפופולריות היא WhatsApp." },

    // שאלות על רשתות חברתיות
    { q: /מה הרשת החברתית הכי גדולה/, a: "הרשת החברתית הכי גדולה היא Facebook." },

    // שאלות על תכנות
    { q: /מה שפת התכנות הכי פופולרית/, a: "שפת התכנות הכי פופולרית היא Python." },

    // שאלות על רובוטים
    { q: /מה זה רובוט|מה זה רובוטיקה/, a: "רובוט הוא מכונה שמבצעת פעולות אוטומטיות." },

    // שאלות על חשמל
    { q: /מה זה חשמל|איך נוצר חשמל/, a: "חשמל הוא זרם של אלקטרונים. נוצר בתחנות כוח." },

    // שאלות על מים
    { q: /מה זה מים|כמה מים יש בכדור הארץ/, a: "מים הם תרכובת של מימן וחמצן. רוב המים בכדור הארץ הם באוקיינוסים." },

    // שאלות על אוכל בריא
    { q: /מה זה אוכל בריא|איך לאכול בריא/, a: "אוכל בריא כולל ירקות, פירות, דגנים מלאים וחלבונים רזים." },

    // שאלות על שינה
    { q: /כמה שעות צריך לישון|כמה שעות שינה מומלץ/, a: "מומלץ לישון 7-8 שעות בלילה." },

    // שאלות על לימודים
    { q: /איך ללמוד טוב|טיפים ללמידה/, a: "ללמוד בסביבה שקטה, לחלק את החומר, לקחת הפסקות ולתרגל." },

    // שאלות על כסף
    { q: /איך לחסוך כסף|טיפים לחיסכון/, a: "לעקוב אחרי ההוצאות, לקבוע תקציב ולהימנע מקניות מיותרות." },

    // שאלות על עבודה
    { q: /איך למצוא עבודה|טיפים למציאת עבודה/, a: "להכין קורות חיים טובים, לחפש במודעות, ולפנות לרשתות חברתיות." },

    // שאלות על אהבה
    { q: /מה זה אהבה|איך למצוא אהבה/, a: "אהבה היא רגש עמוק. למצוא אהבה דרך תקשורת, פתיחות וכבוד הדדי." },

    // שאלות על משפחה
    { q: /מה זה משפחה|איך לשמור על משפחה מאושרת/, a: "משפחה היא קבוצת אנשים קרובים. שמירה על תקשורת, כבוד ותמיכה הדדית חשובה." },

    // שאלות על חברים
    { q: /איך למצוא חברים|טיפים לחברות/, a: "להיות פתוח, להקשיב, ולהשתתף בפעילויות משותפות." },

    // שאלות על אושר
    { q: /איך להיות מאושר|טיפים לאושר/, a: "להעריך את מה שיש, לטפח קשרים טובים, ולעסוק במה שאוהבים." },

    // שאלות על פחדים
    { q: /איך להתמודד עם פחד|טיפים להתמודדות עם פחד/, a: "להכיר בפחד, לדבר עליו, ולתרגל נשימות והרפיה." },

    // שאלות על הצלחה
    { q: /איך להצליח|טיפים להצלחה/, a: "להציב מטרות, להתמיד, ללמוד מטעויות ולהאמין בעצמך." },

    // שאלות על מוטיבציה
    { q: /איך לשמור על מוטיבציה|טיפים למוטיבציה/, a: "לקבוע מטרות ברורות, לפרגן לעצמך, ולזכור את הסיבה להתחלה." },

    // שאלות על זמן פנוי
    { q: /מה לעשות בזמן פנוי|איך להעביר זמן פנוי/, a: "אפשר לקרוא, לצייר, לעשות ספורט, או ללמוד משהו חדש." },

    // שאלות על תחביבים
    { q: /מה זה תחביב|איך למצוא תחביב/, a: "תחביב הוא פעילות מהנה בזמנך הפנוי. נסה דברים חדשים עד שתמצא מה שמעניין אותך." },

    // שאלות על טיולים
    { q: /לאן כדאי לטייל|טיפים לטיול/, a: "אפשר לטייל בטבע, בערים, או במדינות חדשות. תכנן מראש ואל תשכח מים." },

    // שאלות על אוכל ישראלי
    { q: /מה המאכל הישראלי הכי פופולרי/, a: "המאכל הישראלי הכי פופולרי הוא פלאפל." },

    // שאלות על חגים יהודיים
    { q: /מה זה פסח|מה זה ראש השנה|מה זה יום כיפור/, a: "אלו חגים יהודיים חשובים. רוצה לדעת על חג מסוים?" },

    // שאלות על שפות תכנות
    { q: /מה זה JavaScript|מה זה פייתון|מה זה C#/, a: "אלו שפות תכנות פופולריות לפיתוח תוכנה." },

    // שאלות על מדע בדיוני
    { q: /מה זה מדע בדיוני|ספרי מדע בדיוני/, a: "מדע בדיוני הוא ז'אנר ספרותי שעוסק בטכנולוגיה ודמיון." },

    // שאלות על אמנות
    { q: /מה זה אמנות|מי האמן הכי מפורסם/, a: "אמנות היא ביטוי יצירתי. אחד האמנים המפורסמים הוא פיקאסו." },

    // שאלות על היסטוריה ישראלית
    { q: /מתי קמה מדינת ישראל|מי היה ראש הממשלה הראשון/, a: "מדינת ישראל קמה ב־1948. ראש הממשלה הראשון היה דוד בן גוריון." },

    // שאלות על טבע בישראל
    { q: /מה המקום הכי יפה בישראל/, a: "ים המלח, הכנרת והגליל הם מהמקומות היפים בישראל." },

    // שאלות על בעלי חיים בישראל
    { q: /איזה חיות יש בישראל/, a: "בישראל יש שועלים, צבאים, יעלים, דורבנים ועוד." },

    // שאלות על תחבורה ציבורית
    { q: /איך מגיעים לתל אביב|איך מגיעים לירושלים/, a: "אפשר להגיע ברכבת, אוטובוס או רכב פרטי." },

    // שאלות על מזון בריא
    { q: /מה זה מזון אורגני|מה זה מזון טבעי/, a: "מזון אורגני מגודל ללא חומרי הדברה כימיים." },

    // שאלות על טכנולוגיה חדשה
    { q: /מה זה בינה מלאכותית|מה זה מציאות מדומה|מה זה בלוקצ'יין/, a: "אלו טכנולוגיות מתקדמות שמשנות את העולם." },

    // שאלות על אנרגיה ירוקה
    { q: /מה זה אנרגיה ירוקה|מה זה אנרגיה מתחדשת/, a: "אנרגיה ירוקה מופקת ממקורות טבעיים כמו שמש ורוח." },

    // שאלות על סביבה
    { q: /איך לשמור על הסביבה|טיפים לשמירה על הסביבה/, a: "למחזר, לחסוך מים וחשמל, ולהימנע משימוש בפלסטיק." },

    // שאלות על בריאות הנפש
    { q: /איך לשמור על בריאות הנפש|טיפים לבריאות נפשית/, a: "לדבר עם חברים, לעסוק בפעילות גופנית ולפנות לעזרה מקצועית במידת הצורך." },

    // שאלות על ילדים
    { q: /איך לגדל ילדים|טיפים להורות/, a: "להיות קשוב, לתמוך, להציב גבולות ולתת דוגמה אישית." },

    // שאלות על לימודים אוניברסיטאיים
    { q: /איך להתקבל לאוניברסיטה|טיפים ללימודים אקדמיים/, a: "להשקיע בלימודים, להגיש מועמדות בזמן ולבחור תחום שמעניין אותך." },

    // שאלות על עבודה מהבית
    { q: /איך לעבוד מהבית|טיפים לעבודה מרחוק/, a: "ליצור סביבת עבודה נוחה, לקבוע שעות עבודה ולהקפיד על הפסקות." },

    // שאלות על טיולים בעולם
    { q: /לאן כדאי לטוס|מה המדינה הכי יפה בעולם/, a: "איטליה, יפן וניו זילנד הן מדינות יפות לטיול." },

    // שאלות על אוכל טבעוני
    { q: /מה זה אוכל טבעוני|איך להיות טבעוני/, a: "אוכל טבעוני אינו מכיל מוצרים מהחי." },

    // שאלות על חיסונים
    { q: /מה זה חיסון|למה להתחסן/, a: "חיסון מגן מפני מחלות ומסייע לבריאות הציבור." },

    // שאלות על טכנולוגיה ישראלית
    { q: /מה ההמצאה הישראלית הכי מפורסמת/, a: "הדיסק און קי הוא אחת ההמצאות הישראליות המפורסמות." },

    // שאלות על חגים עולמיים
    { q: /מה זה חג המולד|מה זה חג הפסחא/, a: "אלו חגים נוצריים חשובים." },

    // שאלות על אוכל עולמי
    { q: /מה המאכל האיטלקי הכי מפורסם/, a: "המאכל האיטלקי הכי מפורסם הוא פיצה." },

    // שאלות על שפות בעולם
    { q: /מה השפה הכי מדוברת בעולם/, a: "השפה הכי מדוברת בעולם היא סינית." },

    // שאלות על תיירות בישראל
    { q: /מה אתר התיירות הכי פופולרי בישראל/, a: "הכותל המערבי הוא אתר תיירות פופולרי בישראל." },

    // שאלות על חיות מחמד
    { q: /מה החיה הכי מתאימה לבית/, a: "כלבים וחתולים הם חיות מחמד פופולריות." },

    // שאלות על ספורט בישראל
    { q: /מה קבוצת הכדורגל הכי טובה בישראל/, a: "מכבי תל אביב היא אחת הקבוצות המובילות." },

    // שאלות על אוכל בריא לילדים
    { q: /מה אוכל בריא לילדים/, a: "פירות, ירקות, דגנים מלאים ומוצרי חלב דלי שומן." },

    // שאלות על חיסכון באנרגיה
    { q: /איך לחסוך באנרגיה/, a: "לכבות אורות, להשתמש בנורות חסכוניות ולנתק מכשירים מהחשמל." },

    // שאלות על טיפים ללמידה מרחוק
    { q: /איך ללמוד מרחוק|טיפים ללמידה אונליין/, a: "ליצור סדר יום, להשתתף בשיעורים ולהיות פעיל בקבוצות." },

    // שאלות על טיפים לנהיגה בטוחה
    { q: /איך לנהוג בטוח|טיפים לנהיגה/, a: "לשמור מרחק, לא להשתמש בטלפון ולהיות ערני לתנועה." },

    // שאלות על טיפים לשינה טובה
    { q: /איך לישון טוב|טיפים לשינה/, a: "להימנע ממסכים לפני השינה, לשמור על שגרה וליצור סביבה שקטה." },

    // שאלות על טיפים לתזונה נכונה
    { q: /איך לאכול נכון|טיפים לתזונה/, a: "לאכול מגוון, להמעיט בסוכר ומלח, ולהעדיף אוכל טרי." },

    // שאלות על טיפים לספורט
    { q: /איך להתחיל לעשות ספורט|טיפים לספורט/, a: "להתחיל בהדרגה, לבחור פעילות מהנה ולהתמיד." },

    // שאלות על טיפים לניהול זמן
    { q: /איך לנהל זמן|טיפים לניהול זמן/, a: "לתכנן מראש, להציב מטרות ולהשתמש ביומן." },

    // שאלות על טיפים להתמודדות עם לחץ
    { q: /איך להתמודד עם לחץ|טיפים להתמודדות עם לחץ/, a: "לתרגל נשימות, לקחת הפסקות ולדבר עם מישהו קרוב." },

    // שאלות על טיפים לשמירה על קשרים חברתיים
    { q: /איך לשמור על קשרים|טיפים לקשרים חברתיים/, a: "להיות קשוב, לשמור על תקשורת ולהיפגש מדי פעם." },

    // שאלות על טיפים להצלחה בלימודים
    { q: /איך להצליח בלימודים|טיפים להצלחה בלימודים/, a: "להכין סיכומים, לתרגל ולהיעזר במורים." },

    // שאלות על טיפים להצלחה בעבודה
    { q: /איך להצליח בעבודה|טיפים להצלחה בעבודה/, a: "להיות מקצועי, לעבוד בצוות ולהתעדכן בתחום." },

    // שאלות על טיפים להצלחה בזוגיות
    { q: /איך להצליח בזוגיות|טיפים לזוגיות/, a: "לתקשר, לכבד ולהשקיע בקשר." },

    // שאלות על טיפים להצלחה בחיים
    { q: /איך להצליח בחיים|טיפים להצלחה בחיים/, a: "להציב מטרות, ללמוד ולהיות חיובי." }
  ];
  for (const item of builtInAnswers) {
    if (item.q.test(text)) {
      return typeof item.a === "function" ? item.a() : item.a;
    }
  }

  // אם אין תשובה מובנית, פנה ל-API
  try {
    const res = await fetch("https://api.openai.com/v1/chat/completions", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "Authorization": "Bearer sk-XXXXXXXXXX"
      },
      body: JSON.stringify({
        model: "gpt-4o-mini",
        messages: [
          { role: "system", content: "אתה Jarvis, עוזר ידידותי וקצר." },
          { role: "user", content: text }
        ],
        max_tokens: 500
      })
    });
    const j = await res.json();
    return j.choices?.[0]?.message?.content || "אין תשובה";
  } catch (err) {
    console.error("AI error", err);
    return localResponder(text);
  }
}


    function localResponder(t){ const txt = t.toLowerCase();
      // Hebrew greetings
      if(/\b(שלום|היי|מה שלומך)\b/.test(txt)) return 'שלום — איך אפשר לעזור?';
      if(/(פתח|פתחי)\s+spotify|ספוטיפיי/.test(txt)) { window.open('https://open.spotify.com','_blank'); return 'פותח Spotify'; }
      if(/(נגן|נגן את|play)\s+(.+)/i.test(t)){
        const m = t.match(/(?:נגן|נגן את|play)\s+(.+)/i); if(m && m[1]){ const song = m[1].trim(); window.open('https://open.spotify.com/search/'+encodeURIComponent(song),'_blank'); return 'מחפש לנגן: ' + song; }
      }
      if(/(מה השעה|כמה השעה|time)\b/.test(txt)) return new Date().toLocaleTimeString();
      if(/(חשב|חישוב|calculate)\b/.test(txt)){
        const exprMatch = t.match(/([-+*\/\%()0-9\s\.]+)/); if(exprMatch){ const expr = exprMatch[0].replace(/[^0-9+\-*/().% ]/g,''); try{ if(!/[^0-9+\-*/().%\s]/.test(expr) && expr.length<200){ // safety
                // eslint-disable-next-line no-new-func
                const val = Function('return ('+expr+')')(); return 'תוצאה: ' + String(val);
              }
            }catch(e){ }
        }
        return 'לא הצלחתי להבין את הנוסחה. נסה לכתוב ביטוי מתמטי פשוט.';
      }
      if(/(חפש|מצא|search for|google)\s+(.+)/i.test(t)){
        const m=t.match(/(?:חפש|מצא|search for|google)\s+(.+)/i); if(m && m[1]){ window.open('https://www.google.com/search?q='+encodeURIComponent(m[1].trim()),'_blank'); return 'חיפשתי: '+m[1].trim(); }
      }
      // default - give a helpful message
      return 'מצטער — אין לי תשובה מקומית לשאלה הזאת כרגע. חיבור לשרת AI מספק תשובות מורחבות.';
    }

    // Button handlers
    $('micBtn').addEventListener('click', ()=>{
      if($('micBtn').classList.contains('listening')){ // stop
        try{ recognition && recognition.stop(); }catch(e){} $('micBtn').classList.remove('listening'); $('micBtn').textContent='הפעל מיקרופון'; stopAudio();
      } else { startMic(); }
    });

    $('sendBtn').addEventListener('click', async ()=>{ const t=$('textInput').value.trim(); if(!t) return; addMessage(t,'user'); $('textInput').value=''; const reply=await askAI(t); addMessage(reply,'jarvis'); speak(reply, detectLangFromText(reply)); });
    $('textInput').addEventListener('keydown', e=>{ if(e.key==='Enter'){ e.preventDefault(); $('sendBtn').click(); } });

    // init
    addMessage('שלום. דבר או כתוב כדי להתחיל. Jarvis מוכן.','jarvis');

    /*
      ===== שרת דוגמה (Node/Express) =====
      שמור את הקוד הזה בקובץ server.js והגדר את OPENAI_API_KEY בסביבת העבודה.

      // server.js
      const express = require('express');
      const fetch = require('node-fetch');
      const app = express(); app.use(express.json());
      const OPENAI_KEY = process.env.OPENAI_API_KEY; // ציין את המפתח בסביבת ההרצה

      app.post('/api/ai', async (req,res)=>{
        try{
          const prompt = req.body.prompt || '';
          const resp = await fetch('https://api.openai.com/v1/chat/completions',{ method:'POST', headers:{ 'Content-Type':'application/json', 'Authorization':`Bearer ${OPENAI_KEY}` }, body: JSON.stringify({ model:'gpt-4o-mini', messages:[{role:'system',content:'You are Jarvis, a concise helpful assistant.'},{role:'user',content:prompt}], max_tokens:500 }) });
          const j = await resp.json(); const reply = j.choices?.[0]?.message?.content || 'אין תשובה';
          res.json({reply});
        }catch(err){ console.error(err); res.status(500).json({error:'AI error'}); }
      });

      app.use(express.static('.')); // serve frontend file too
      app.listen(3000, ()=>console.log('listening on 3000'));

      להרצה:
      1. npm init -y
      2. npm i express node-fetch
      3. export OPENAI_API_KEY="sk-..." (או יצירת .env והשתמש ב־cross-env)
      4. node server.js

      פתיחת האתר: http://localhost:3000/Jarvis_modern_v2.html (או השם שהקובץ שלך שמור בו)

      חשוב: שרת חשוב כדי לא לחשוף מפתחות ל־OpenAI בצד הלקוח.

      proj-M9DZbp7Xd29OlZqGjLlEc6lk-VkOe_wmQkq8HFxJeQxxtADbyDdzNxUz15lPEk_VD-xkrg2Oh8T3BlbkFJugSfl8ae2k1AOZ4pSYyIJ_ujTI-HlmXhlt1bfKVbsvw2hlX7cdspTqJjOCXR7KXEQo3rWzaF8A
    */
  </script>
</body>
</html>
